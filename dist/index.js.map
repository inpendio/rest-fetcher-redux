{"version":3,"file":"index.js","sources":["../src/Transformers.js","../src/Api.js","../index.js"],"sourcesContent":["import { isObject, isArray, toPlainObject, toArray } from 'lodash';\n\nexport const object = (data = {}) => {\n  if (isObject(data)) return data;\n  let _data = false;\n  if (typeof data === 'string') {\n    try {\n      _data = JSON.parse(data.trim());\n    } catch (e) {\n      console.log(e);\n    }\n  }\n  if (_data) return _data;\n  return toPlainObject(data);\n};\nexport const array = (data = []) => {\n  if (isArray) return data;\n  return toArray(data);\n};\n\nexport const cumulativeArray = check => (data = [], oldData = []) => {\n  if (!data) return oldData;\n  if (!check) return oldData.concat(isArray(data) ? data : toArray(data));\n  const newData = [...oldData];\n  data.forEach((d) => {\n    let doesExist = false;\n    oldData.forEach((o, i) => {\n      if (d[check] === o[check]) {\n        newData[i] = d;\n        doesExist = true;\n      }\n    });\n    if (!doesExist) newData.push(d);\n  });\n  return newData;\n};\n\nexport default {\n  object,\n  array,\n  cumulativeArray,\n};\n","import { isFunction } from 'lodash';\nimport { Base } from 'rest-fetcher-base';\nimport { object as tObject } from './Transformers';\n\nexport default class RFR extends Base {\n  constructor() {\n    super();\n    this.endpointCreationPool.push(this.addToReducerPool);\n    this.endpointCreationPool.push(this.addToTransformerPool);\n  }\n\n  /**\n   * @description Reducer you export to your store.\n   * This will extract name of the function ( as it containes prefix and sufix).\n   * Calls generic reducer set for given name.\n   * @param {Object} state - state\n   * @param {Object} action - action\n   * @memberof Communicator\n   */\n  reducer = (state = this.genererateInitialState(), action) => {\n    if (action.type.indexOf(this.basePrefix) === -1) return state;\n    let name = action.type.substring(this.basePrefix.length);\n    if (name.indexOf('_success') !== -1) {\n      name = name.replace('_success', '');\n    }\n    if (name.indexOf('_fail') !== -1) {\n      name = name.replace('_fail', '');\n    }\n    return this.reducerPool[name](state, action);\n  };\n\n  /**\n   * @description reducer for specific function name\n   * @param {String} k - name of the function\n   * @param {Object} state - state\n   * @param {Object} action - action\n   * @memberof Communicator\n   */\n  constructGenericReducer = k => (state, action) => {\n    const newState = Object.assign({}, state);\n    newState[k] = Object.assign({}, state[k]);\n    /* Object.keys(state).forEach(key => {\n      newState[key] = Object.assign({}, state[key]);\n    }); */\n    if (action.loading) {\n      if (newState.isLoading && newState.isLoading.length) {\n        newState.isLoading.push(k);\n      } else {\n        newState.isLoading = [];\n        newState.isLoading.push(k);\n      }\n    } else {\n      if (newState.isLoading && newState.isLoading.length && newState.isLoading.indexOf(k) !== -1) {\n        newState.isLoading.splice(newState.isLoading.indexOf(k), 1);\n      }\n      if (newState.isLoading && newState.isLoading.length === 0) {\n        newState.isLoading = false;\n      }\n    }\n    /* newState.isLoading = action.loading; */\n    if (action.type.indexOf('_success') !== -1) {\n      newState[k].loading = false;\n      newState[k].data = this.transformerPool[k](action.payload.data);\n      newState[k].ok = action.payload.msg.ok;\n      newState[k].redirected = action.payload.msg.redirected;\n      newState[k].status = action.payload.msg.status;\n      newState[k].type = action.payload.msg.type;\n    } else if (action.type.indexOf('_fail') !== -1) {\n      newState[k].loading = false;\n      newState[k].ok = action.payload.msg.ok;\n      newState[k].redirected = action.payload.msg.redirected;\n      newState[k].status = action.payload.msg.status;\n      newState[k].type = action.payload.msg.type;\n      newState[k].error = action.payload.error;\n    } else {\n      newState[k].loading = true;\n      newState[k].request = action.payload.request;\n      newState[k].params = action.payload.params;\n    }\n    return newState;\n  };\n\n  /**\n   * @description Function that creates initial state for each api call for reducer.\n   * @returns state for api reducer\n   */\n  genererateInitialState = () => {\n    const state = {};\n    state.isLoading = false;\n    Object.keys(this.reducerPool).forEach((k) => {\n      state[k] = {\n        request: '',\n        params: '{}',\n        data: this.transformerPool[k](),\n        ok: undefined,\n        redirected: undefined,\n        status: 0,\n        type: '',\n      };\n    });\n    return state;\n  };\n\n  /**\n   * @description Function that creates redux action.\n   * Adds pefix to type\n   * @param {String} name - name of the action\n   * @param {Object} request - payload item\n   * @param {Object} params - payload item\n   */\n  actionStart = (name, request, params) => ({\n    type: `${this.basePrefix}${name}`,\n    /* name, */\n    loading: true,\n    payload: {\n      request,\n      params,\n    },\n  });\n\n  /**\n   * @description Function that creates redux action.\n   * Adds sufix to type\n   * @param {String} name - name of the action\n   * @param {Object} request - payload item\n   * @param {Object} params - payload item\n   */\n  actionEnd = (name, data, msg = {}) => ({\n    type: `${this.basePrefix}${name}_success`,\n    /* name, */\n    loading: false,\n    payload: {\n      data,\n      msg,\n    },\n  });\n\n  /**\n   * @description Function that creates redux action.\n   * Adds sufix to type\n   * @param {String} name - name of the action\n   * @param {Object} request - payload item\n   * @param {Object} params - payload item\n   */\n  actionError = (name, msg = {}, error) => ({\n    type: `${this.basePrefix}${name}_fail`,\n    loading: false,\n    payload: {\n      msg,\n      error,\n    },\n  });\n\n  /**\n   * @description Function that adds a postfetch method to postfetch pool for future use\n   * @param {Object} endpoint - function will extract postfetch key from endpoint if one exists\n   * @param {String} name - a name of the endpoint\n   * @memberof Communicator\n   */\n  addToReducerPool = ({ reducer }, name) => {\n    this.reducerPool[name] = reducer || this.constructGenericReducer(name);\n  };\n\n  /**\n   * @description Function that adds a final data tranformer for future use\n   * @param {Object} endpoint - function will extract transformer key from endpoint if one exists\n   * @param {String} name - a name of the endpoint\n   * @memberof Communicator\n   */\n  addToTransformerPool = ({ transformer = tObject }, name) => {\n    if (transformer && isFunction(transformer)) {\n      this.transformerPool[name] = transformer;\n    }\n  };\n\n  getReducer = () => this.reducer;\n}\n","import { Api } from './src';\n\nexport { object, cumulativeArray, array, Api } from './src';\n\nexport default new Api();\n"],"names":["object","data","isObject","_data","JSON","parse","trim","e","console","log","toPlainObject","array","isArray","toArray","cumulativeArray","check","oldData","concat","newData","forEach","d","doesExist","o","i","push","RFR","reducer","state","genererateInitialState","action","type","indexOf","basePrefix","name","substring","length","replace","reducerPool","constructGenericReducer","k","newState","Object","assign","loading","isLoading","splice","transformerPool","payload","ok","msg","redirected","status","error","request","params","keys","undefined","actionStart","actionEnd","actionError","addToReducerPool","addToTransformerPool","transformer","tObject","isFunction","getReducer","endpointCreationPool","Base","Api"],"mappings":"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"}